<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<style>
body{font-family:Arial;background:#eef2f7;padding:30px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:10px;text-align:center}
button{padding:5px 10px;border:none;border-radius:5px;background:#2563eb;color:white;cursor:pointer}
button:hover{background:#1e40af}
</style>
</head>

<body>

<h2>Admin Panel</h2>

<table>
<thead>
<tr>
<th>Email</th>
<th>Txn</th>
<th>Paid</th>
<th>Method</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>

<tbody id="tbody"></tbody>
</table>

<script>
const BASE="https://digital-marketing-course.onrender.com";

// Load transactions from backend API
async function loadTransactions(){
    try {
        const res = await fetch(BASE + "/transactions"); // <-- updated endpoint
        const data = await res.json();
        const tbody = document.getElementById("tbody");
        tbody.innerHTML = '';

        data.forEach(tx => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
            <td>${tx.email}</td>
            <td>${tx.txn}</td>
            <td>${tx.paidAmount}</td>
            <td>${tx.method}</td>
            <td>${tx.status}</td>
            <td>
                ${tx.status === "pending" ? `<button onclick="verify('${tx.txn}')">Verify</button>` : "âœ”"}
            </td>`;
            tbody.appendChild(tr);
        });
    } catch (e) {
        console.error("Failed to load transactions:", e);
    }
}

// Verify payment (admin only)
async function verify(txn){
    try {
        const res = await fetch(BASE + "/verify-payment", {
            method: "POST",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({txn})
        });
        if(res.ok){
            loadTransactions(); // refresh table
        } else {
            const data = await res.json();
            alert(data.message || "Failed to verify");
        }
    } catch(e){
        alert("Error connecting to server");
        console.error(e);
    }
}

// Load table on page load
loadTransactions();
</script>

</body>
</html>
